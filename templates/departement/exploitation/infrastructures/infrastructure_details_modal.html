<!-- Infrastructure Details Modal Template -->
<div class="modal fade" id="infrastructureDetailsModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h3 id="infrastructureDetailsTitle">Infrastructure Details</h3>
                    <p id="infrastructureDetailsSubtitle">Detailed information and documents</p>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <div class="row g-4">
                    <!-- Infrastructure Details Column -->
                    <div class="col-md-6">
                        <div class="details-card">
                            <div class="card-header">
                                <h5>General Information</h5>
                            </div>
                            <div class="card-body">
                                <div class="detail-row">
                                    <span class="detail-label">Name:</span>
                                    <span class="detail-value" id="detailNom"></span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Type:</span>
                                    <span class="detail-value" id="detailType"></span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Location:</span>
                                    <span class="detail-value" id="detailLocalisation"></span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Capacity:</span>
                                    <span class="detail-value" id="detailCapacite"></span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Status:</span>
                                    <span class="detail-value" id="detailEtat"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- File Upload and Existing Files Column -->
                    <div class="col-md-6">
                        <div class="details-card">
                            <div class="card-header">
                                <h5>Documents and Media</h5>
                            </div>
                            <div class="card-body">
                                <!-- File Upload Section -->
                                <div class="file-upload-section">
                                    <label for="documentUpload" class="upload-label">
                                        <i class="ri-upload-cloud-line"></i> Upload Documents
                                    </label>
                                    <div class="upload-container">
                                        <input type="file" 
                                               class="file-input" 
                                               id="documentUpload" 
                                               multiple 
                                               accept=".pdf,.jpg,.jpeg,.png">
                                        <div class="upload-overlay">
                                            <p>Drag and drop or click to upload</p>
                                        </div>
                                    </div>
                                    <small class="upload-help">
                                        Accepted formats: PDF, JPG, PNG (max 10 MB per file)
                                    </small>
                                    <div id="uploadedFilesList" class="uploaded-files-grid"></div>
                                </div>

                                <!-- Existing Files Section -->
                                <div class="existing-files-section">
                                    <h6>
                                        <i class="ri-file-list-3-line"></i> 
                                        Existing Documents
                                    </h6>
                                    <div id="existingFilesContainer" class="existing-files-gallery">
                                        <!-- Placeholder for dynamically added files -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveInfrastructureDetailsBtn">
                    Save Changes
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Existing styles from infrastructures.html for file and modal design */
    :root {
        --color-primary: #4a6cf7;
        --color-secondary: #6a7693;
        --color-background: #f4f7fa;
        --color-text-dark: #2c3242;
        --color-text-light: #6b7280;
        --color-border: #e5e7eb;
        --color-white: #ffffff;
    }

    /* Existing modal and file grid styles */
    .modal-content {
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .modal-header {
        border-bottom: 1px solid var(--color-border);
        padding: 1.5rem;
    }

    .modal-title-section h3 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .modal-title-section p {
        color: var(--color-text-light);
        font-size: 0.9rem;
    }

    /* Detailed file grid and upload styles */
    .details-card {
        background-color: var(--color-white);
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        overflow: hidden;
    }

    .details-card .card-header {
        background-color: var(--color-background);
        padding: 1rem;
        border-bottom: 1px solid var(--color-border);
    }

    .details-card .card-header h5 {
        font-size: 1rem;
        font-weight: 600;
        margin: 0;
    }

    .details-card .card-body {
        padding: 1.5rem;
    }

    .detail-row {
        display: flex;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--color-border);
    }

    .detail-label {
        flex: 0 0 40%;
        color: var(--color-text-light);
        font-weight: 500;
    }

    .detail-value {
        flex: 1;
        font-weight: 600;
    }

    /* File upload and grid styles */
    .file-upload-section {
        margin-bottom: 1.5rem;
    }

    .upload-label {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
        color: var(--color-primary);
        font-weight: 600;
    }

    .upload-label i {
        margin-right: 0.5rem;
        font-size: 1.25rem;
    }

    .upload-container {
        border: 2px dashed var(--color-border);
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        transition: background-color 0.3s ease;
    }

    .upload-container:hover {
        background-color: rgba(74, 108, 247, 0.05);
    }

    .file-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }

    .upload-help {
        display: block;
        margin-top: 0.5rem;
        color: var(--color-text-light);
        font-size: 0.8rem;
    }

    .uploaded-files-grid,
    .existing-files-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
        gap: 10px;
        margin-top: 1rem;
    }

    .uploaded-files-grid .file-thumbnail,
    .existing-files-gallery .gallery-item {
        position: relative;
        width: 100%;
        aspect-ratio: 1 / 1;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border: 1px solid var(--color-border);
    }

    .uploaded-files-grid .file-thumbnail img,
    .existing-files-gallery .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .uploaded-files-grid .file-thumbnail:hover,
    .existing-files-gallery .gallery-item:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .gallery-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }

    .gallery-item-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.5rem;
    }

    .gallery-item-content i {
        font-size: 24px;
        color: var(--color-primary);
    }

    .gallery-item-content .file-name {
        font-size: 0.8rem;
        color: var(--color-text-dark);
    }

    .gallery-item-actions {
        display: flex;
        gap: 6px;
    }

    .gallery-item-actions .btn-gallery-action {
        background: rgba(255,255,255,0.9);
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        transition: transform 0.2s ease;
    }

    .gallery-item-actions .btn-gallery-action:hover {
        transform: scale(1.1);
    }

    .gallery-item-actions .btn-gallery-action i {
        font-size: 12px;
        color: var(--color-text-dark);
    }

    /* Compact File Type Icons */
    .file-thumbnail.pdf-file,
    .file-thumbnail.doc-file,
    .file-thumbnail.other-file {
        background-color: var(--color-background);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .file-thumbnail.pdf-file i,
    .file-thumbnail.doc-file i,
    .file-thumbnail.other-file i {
        font-size: 24px;
        color: var(--color-primary);
    }

    /* Responsive Adjustments */
    @media (max-width: 576px) {
        .uploaded-files-grid,
        .existing-files-gallery {
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 6px;
        }
    }
</style>

<script>
    // Placeholder for modal-specific JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize modal interactions
        const infrastructureDetailsModal = document.getElementById('infrastructureDetailsModal');
        
        // Example of how to populate details dynamically
        function populateInfrastructureDetails(infrastructureData) {
            document.getElementById('detailNom').textContent = infrastructureData.nom;
            document.getElementById('detailType').textContent = infrastructureData.type;
            document.getElementById('detailLocalisation').textContent = infrastructureData.localisation;
            document.getElementById('detailCapacite').textContent = `${infrastructureData.capacite} mÂ³`;
            document.getElementById('detailEtat').textContent = infrastructureData.etat;
        }

        // Example of file upload handling
        const documentUpload = document.getElementById('documentUpload');
        const uploadedFilesList = document.getElementById('uploadedFilesList');

        documentUpload.addEventListener('change', function(event) {
            uploadedFilesList.innerHTML = ''; // Clear previous uploads
            
            Array.from(this.files).forEach(file => {
                const fileReader = new FileReader();
                fileReader.onload = function(e) {
                    const fileThumbnail = document.createElement('div');
                    fileThumbnail.className = `file-thumbnail ${getFileTypeClass(file.name)}`;
                    
                    if (e.target.result.startsWith('data:image')) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        fileThumbnail.appendChild(img);
                    } else {
                        const icon = document.createElement('i');
                        icon.className = getFileTypeIcon(file.name);
                        fileThumbnail.appendChild(icon);
                    }

                    const fileOverlay = document.createElement('div');
                    fileOverlay.className = 'file-overlay';
                    fileThumbnail.appendChild(fileOverlay);

                    uploadedFilesList.appendChild(fileThumbnail);
                };
                fileReader.readAsDataURL(file);
            });
        });

        function getFileTypeClass(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            switch(extension) {
                case 'pdf': return 'pdf-file';
                case 'doc':
                case 'docx': return 'doc-file';
                default: return 'other-file';
            }
        }

        function getFileTypeIcon(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            switch(extension) {
                case 'pdf': return 'ri-file-pdf-line';
                case 'doc':
                case 'docx': return 'ri-file-word-line';
                case 'jpg':
                case 'jpeg':
                case 'png': return 'ri-image-line';
                default: return 'ri-file-line';
            }
        }

        function populateExistingFiles(files) {
            const existingFilesContainer = document.getElementById('existingFilesContainer');
            existingFilesContainer.innerHTML = ''; // Clear previous files

            files.forEach(file => {
                const galleryItem = document.createElement('div');
                galleryItem.className = `gallery-item ${getFileTypeClass(file.name)}`;

                const galleryItemContent = document.createElement('div');
                galleryItemContent.className = 'gallery-item-content';

                const icon = document.createElement('i');
                icon.className = getFileTypeIcon(file.name);
                
                const fileName = document.createElement('span');
                fileName.className = 'file-name';
                fileName.textContent = file.name;

                galleryItemContent.appendChild(icon);
                galleryItemContent.appendChild(fileName);

                const galleryItemActions = document.createElement('div');
                galleryItemActions.className = 'gallery-item-actions';

                const viewButton = document.createElement('button');
                viewButton.className = 'btn-gallery-action view';
                viewButton.title = 'View';
                viewButton.innerHTML = '<i class="ri-eye-line"></i>';
                viewButton.addEventListener('click', () => viewFile(file));

                const downloadButton = document.createElement('button');
                downloadButton.className = 'btn-gallery-action download';
                downloadButton.title = 'Download';
                downloadButton.innerHTML = '<i class="ri-download-line"></i>';
                downloadButton.addEventListener('click', () => downloadFile(file));

                galleryItemActions.appendChild(viewButton);
                galleryItemActions.appendChild(downloadButton);

                galleryItem.appendChild(galleryItemContent);
                galleryItem.appendChild(galleryItemActions);

                existingFilesContainer.appendChild(galleryItem);
            });
        }

        function viewFile(file) {
            // Implement file viewing logic
            console.log('Viewing file:', file.name);
            // You might want to open a modal or use a lightbox to view the file
        }

        function downloadFile(file) {
            // Implement file download logic
            console.log('Downloading file:', file.name);
            // You might want to trigger a download or use an API endpoint
        }
    });
</script>
